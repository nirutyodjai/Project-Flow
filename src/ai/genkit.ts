import {genkit} from 'genkit';
import {googleAI} from '@genkit-ai/googleai';
import dotenv from 'dotenv';

// โหลดค่าจากไฟล์ .env
dotenv.config();

// ตรวจสอบว่ามีการกำหนดค่า API key สำหรับ Google AI หรือไม่
const apiKey = process.env.GEMINI_API_KEY;
if (!apiKey) {
  console.warn('⚠️ GEMINI_API_KEY ไม่ได้ถูกกำหนดใน .env file - AI อาจทำงานไม่เต็มประสิทธิภาพ');
}

/**
 * กำหนดค่า genkit สำหรับการค้นหาและวิเคราะห์โครงการ
 * ปรับแต่งพารามิเตอร์เพื่อให้เหมาะกับการวิเคราะห์โครงการประมูล:
 * - temperature: ค่าต่ำเพื่อให้ผลลัพธ์มีความเป็นเหตุเป็นผลและแม่นยำ
 * - maxOutputTokens: เพิ่มเพื่อรองรับการวิเคราะห์ที่ละเอียดขึ้น
 * - topK & topP: ปรับเพื่อให้ผลลัพธ์มีความสร้างสรรค์แต่ยังคงเป็นเหตุเป็นผล
 */
export const ai = genkit({
  plugins: [
    googleAI({
      apiKey: apiKey,
      options: {
        temperature: 0.3,  // ลดค่าเพื่อให้ผลลัพธ์มีความแน่นอนมากขึ้น
        maxOutputTokens: 2048,  // เพิ่มจำนวนโทเค็นสำหรับการวิเคราะห์ที่ซับซ้อน
        topK: 40,  // ปรับค่าให้เหมาะสมกับการวิเคราะห์ข้อมูลทางธุรกิจ
        topP: 0.95,  // คงความหลากหลายของผลลัพธ์ในระดับที่เหมาะสม
      }
    })
  ],
  model: 'googleai/gemini-2.0-flash-exp', // อัพเกรดเป็น Gemini 2.0 Flash (ล่าสุด)
  defaults: {
    retry: {
      attempts: 3,  // จำนวนครั้งที่จะพยายามซ้ำเมื่อเกิดข้อผิดพลาด
      backoff: 1000,  // เวลาที่รอระหว่างการพยายามซ้ำ (มิลลิวินาที)
    },
    cache: true,  // เปิดใช้การแคชผลลัพธ์เพื่อประหยัดทรัพยากรและเพิ่มความเร็ว
  }
});

/**
 * กำหนดค่า genkit พิเศษสำหรับการวิเคราะห์โครงการประมูลโดยเฉพาะ
 * ปรับแต่งพารามิเตอร์เพื่อให้เหมาะกับการวิเคราะห์งานประมูลเชิงลึก:
 * - temperature: ค่าต่ำมากเพื่อให้ผลลัพธ์มีความแม่นยำสูงสุด
 * - maxOutputTokens: เพิ่มมากขึ้นเพื่อรองรับการวิเคราะห์เชิงลึกที่ซับซ้อน
 */
export const procurementAI = genkit({
  plugins: [
    googleAI({
      apiKey: apiKey,
      options: {
        temperature: 0.2,  // ลดค่าต่ำมากเพื่อความแม่นยำสูง
        maxOutputTokens: 4096,  // เพิ่มจำนวนโทเค็นมากขึ้นสำหรับการวิเคราะห์เชิงลึก
        topK: 30,  // ค่าต่ำลงเพื่อให้โฟกัสมากขึ้น
        topP: 0.85,  // ลดความหลากหลายเพื่อเพิ่มความแม่นยำ
      }
    })
  ],
  model: 'googleai/gemini-2.0-flash-exp', // อัพเกรดเป็น Gemini 2.0 Flash (ล่าสุด)
  defaults: {
    retry: {
      attempts: 5,  // เพิ่มจำนวนครั้งที่พยายามซ้ำเมื่อเกิดข้อผิดพลาด
      backoff: 1500,  // เพิ่มเวลารอระหว่างการพยายามซ้ำ
    },
    cache: {
      enabled: true,
      ttl: 43200,  // 12 ชั่วโมง แคชสำหรับการวิเคราะห์โครงการ
    }
  }
});

/**
 * กำหนดค่า genkit พิเศษสำหรับการวิเคราะห์ตลาดหุ้นและข้อมูลทางการเงิน
 * ปรับแต่งพารามิเตอร์เพื่อให้เหมาะกับการวิเคราะห์ตลาดการเงินและหุ้น:
 * - temperature: ปรับให้เหมาะกับการวิเคราะห์ข้อมูลทางการเงินที่ต้องการความแม่นยำสูงแต่ยังมีความยืดหยุ่น
 * - maxOutputTokens: เพียงพอสำหรับการวิเคราะห์ตลาดหุ้นและข้อมูลทางการเงิน
 * - topK & topP: ปรับแต่งเพื่อให้เหมาะกับการคาดการณ์แนวโน้มที่ต้องมีความแม่นยำ
 */
export const marketAI = genkit({
  plugins: [
    googleAI({
      apiKey: apiKey,
      options: {
        temperature: 0.25,  // ค่าต่ำเพื่อความแม่นยำในการวิเคราะห์ข้อมูลทางการเงิน
        maxOutputTokens: 3072,  // เพิ่มจำนวนโทเค็นสำหรับการวิเคราะห์ตลาดที่ซับซ้อน
        topK: 35,  // ปรับค่าให้เหมาะสมกับการวิเคราะห์ตลาดหุ้น
        topP: 0.9,  // ลดการสร้างความหลากหลายเพื่อเพิ่มความแม่นยำในการคาดการณ์
      }
    })
  ],
  model: 'googleai/gemini-2.0-flash-exp', // อัพเกรดเป็น Gemini 2.0 Flash (ล่าสุด)
  defaults: {
    retry: {
      attempts: 4,  // เพิ่มจำนวนครั้งที่พยายามซ้ำเมื่อเกิดข้อผิดพลาด
      backoff: 1200,  // เวลาที่รอระหว่างการพยายามซ้ำ (มิลลิวินาที)
    },
    cache: {
      enabled: true,
      ttl: 21600,  // 6 ชั่วโมง แคชสำหรับการวิเคราะห์ตลาดหุ้น (ข้อมูลตลาดเปลี่ยนแปลงเร็วกว่า)
    }
  }
});
